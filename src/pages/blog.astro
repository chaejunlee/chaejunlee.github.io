---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../config";
import { getDates } from "../utils/dates";
import type { BlogProps } from "../layouts/BlogPost.astro";
import TagList from "../components/TagList.astro";

interface Frontmatter {
  frontmatter: BlogProps;
  url: string | undefined;
}

// Use Astro.glob() to fetch all posts, and then sort them by date.
const posts = (await Astro.glob<Frontmatter>("./blog/*.{md,mdx}")).sort(
  (a, b) => {
    const postB = (b.frontmatter?.updatedDate ||
      b.frontmatter.pubDate) as string;
    const postA = (a.frontmatter?.updatedDate ||
      a.frontmatter.pubDate) as string;
    return new Date(postB).valueOf() - new Date(postA).valueOf();
  }
);
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    <style>
      .card {
        border-radius: 0.5rem;
        padding-block: 2em;
        border-bottom: 2px solid #eee;
        display: flex;
        gap: 2rem;
      }
      .card-content {
        flex-shrink: 0;
      }
      .card-image {
        object-fit: cover;
        width: 200px;
        aspect-ratio: 1/1;
        border-width: 0.25rem;
        border-style: solid;
        border-color: #ccc;
        border-radius: 1rem;
        overflow: hidden;
      }
      .card-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 0.5rem;
        border-width: 0;
        margin: 0;
      }
      .card-title {
        margin: 0;
        font-size: 1.5em;
        font-weight: 600;
      }
      .card-link {
        text-decoration: none;
        color: black;
      }
      .card-link:hover {
        text-decoration: underline;
      }
      p {
        margin: 0;
      }
      a:hover h3 {
        color: var(--primary-800);
      }
      @media (max-width: 768px) {
        .card {
          flex-direction: column;
          gap: 1rem;
        }
        .card-image {
          width: auto;
          aspect-ratio: 2/1;
        }
      }
    </style>
  </head>
  <body>
    <Header />
    <main>
      <section>
        {
          posts.map((post) => (
            <div class="card">
              <a class="card-link" href={post.url}>
                <div class="card-image">
                  <img
                    src={post.frontmatter.heroImage ?? "/placeholder-hero.jpg"}
                  />
                </div>
              </a>
              <div class="card-content">
                <h3 class="card-title">
                  <a class="card-link" href={post.url}>
                    {post.frontmatter.title}
                  </a>
                </h3>
                <p>{post.frontmatter.description}</p>
                {post.frontmatter.tags && (
                  <TagList tags={post.frontmatter.tags} />
                )}
                <time class="text-gray" datetime={post.frontmatter.pubDate}>
                  {getDates(post.frontmatter.pubDate || "")}
                </time>
              </div>
            </div>
          ))
        }
      </section>
    </main>
    <Footer />
  </body>
</html>
